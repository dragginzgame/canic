#!/usr/bin/env bash
set -euo pipefail

# Pre-commit: auto-format Rust code and proceed.
# Note: This will stage all tracked formatting changes (git add -u).

if ! command -v cargo >/dev/null 2>&1; then
  echo "cargo not found; skipping rustfmt"
  exit 0
fi

echo "Auto-formatting with cargo fmt..."
if ! cargo fmt --all; then
  echo "cargo fmt failed; aborting commit." >&2
  exit 1
fi

# Stage only tracked files changed by formatting
git add -u

echo "Formatting complete; proceeding with commit."
exit 0
