#!/usr/bin/env bash
set -euo pipefail

# Auto-format before checks (matches `make fmt` without ensure-hooks)
make fmt-core

# Stage any formatting changes so they are included in the commit
if ! git diff --quiet; then
  echo "Formatting changed files; staging tracked updates..."
  git add -u
fi

# Run checks
make fmt-check-core

echo "Pre-commit checks passed."
