# Canic 0.12: Root Role Attestation Framework

## 1. Overview

Canic 0.12 introduces a Root Role Attestation Framework that enables canisters to prove their structural classification (for example, `CanisterRole` and subnet membership) to other canisters without querying or synchronizing the full Root registry.

This release builds on the 0.11 Root Capability framework and introduces a new cryptographic evidence layer for caller classification.

Attestations are:

- Signed by Root
- Time-bounded
- Subject-bound to a principal
- Verifiable offline
- Independent of delegation tokens

0.12 reduces runtime reliance on `SubnetDirectory` for caller validation.

## 2. Goals

### Primary Goals

- Enable portable, verifiable role proofs.
- Eliminate full directory synchronization for classification checks.
- Preserve strict cryptographic domain separation.
- Support revocation via TTL, epoch, and key rotation.
- Avoid introducing arbitrary signing primitives.

### Non-Goals

- No change to 0.11 execution dispatcher.
- No change to delegation issuance.
- No distributed consensus across subnets.
- No general-purpose capability token system.
- No persistent capability grants.

## 3. Problem Statement

Prior to 0.12:

- Services must consult `SubnetDirectory` or synced registry data to validate caller role.
- Structural membership requires large state distribution.
- Caller classification creates scalability pressure.

Goal:

Allow any canister to prove its `CanisterRole` to any other canister using Root-signed evidence.

## 4. Architectural Model

### 4.1 Separation of Domains

0.12 introduces a second cryptographic domain:

| Domain | Purpose | Key |
| --- | --- | --- |
| Delegation | Authority to act | Delegation PK |
| Attestation | Classification evidence | Attestation PK |

These domains **MUST** remain isolated.

Delegation keys **MUST NOT** sign attestations.  
Attestation keys **MUST NOT** sign delegation tokens.

## 5. Root Attestation Capability

### 5.1 Capability Addition

Root adds a new capability:

```rust
enum RootCapability {
    ...
    IssueRoleAttestation,
}
```

### 5.2 Request

```rust
enum RootCapabilityRequest {
    ...
    IssueRoleAttestation {
        subject: Principal,
        role: Role,
    },
}
```

Root **MUST** validate structural eligibility before issuing.

## 6. Attestation Model

### 6.1 `RoleAttestation`

```rust
struct RoleAttestation {
    subject: Principal,
    role: Role,
    subnet_id: Option<Principal>,
    audience: Option<Principal>,
    issued_at: u64,
    expires_at: u64,
    epoch: u64,
}
```

Wrapped as:

```rust
struct SignedRoleAttestation {
    payload: RoleAttestation,
    signature: Vec<u8>,
    key_id: u32,
}
```

## 7. Verification Rules

A verifier **MUST**:

1. Resolve verification key by `key_id`.
2. Validate signature.
3. Enforce `payload.subject == ic::caller()`.
4. Enforce `expires_at >= now`.
5. If present, enforce `audience == ic::id()`.
6. If present, enforce subnet equality.
7. Enforce `epoch >= min_accepted_epoch`.

Verification **MUST** fail closed on error.

No registry lookup is required.

## 8. TTL and Lifetime

Attestation lifetime **MUST** satisfy:

```text
0 < (expires_at - issued_at) <= MAX_ATTESTATION_TTL_SECONDS
```

Recommended:

```text
MAX_ATTESTATION_TTL_SECONDS <= 900
```

Short TTLs are required for safe revocation semantics.

## 9. Revocation Model

Revocation mechanisms:

- TTL expiration.
- Epoch bumping.
- Key rotation.

Each role **MUST** define a `min_accepted_epoch`.

Verifiers **MUST** reject attestations where:

```text
payload.epoch < min_accepted_epoch
```

## 10. Key Distribution

### 10.1 Attestation KeySet Endpoint

Root **MUST** expose a read-only endpoint:

```rust
fn attestation_key_set() -> AttestationKeySet;
```

Containing:

- `key_id`
- `public_key`
- key status (`current`, `previous`)
- validity metadata

The Root canister principal is the trust anchor.

Endpoint **SHOULD** be certified.

### 10.2 Service Cache Requirements

Services **MUST**:

- Fetch keys at startup.
- Refresh periodically.
- Refresh immediately upon unknown `key_id`.
- Attempt at most one refresh per request.

Verification **MUST** fail closed if key resolution fails.

## 11. Authority Separation Invariant

The following **MUST** hold:

```text
Attestation issuance does not imply execution authority.
Delegation tokens do not imply structural role membership.
```

Attestations are classification evidence only.

## 12. Security Considerations

### 12.1 Forgery Resistance

Relies on:

- Secure signing key
- Subject binding
- TTL enforcement
- Epoch enforcement

### 12.2 Replay Resistance

Attestations are bearer objects but are:

- Subject-bound
- Time-bounded
- Audience-bound (when required)

Replay across callers is prevented by subject equality check.

### 12.3 Blast Radius

If attestation key is compromised:

- Role proofs compromised
- Delegation unaffected
- Structural capabilities unaffected

If delegation key is compromised:

- Delegation compromised
- Attestation unaffected

## 13. Scalability Impact

- Removes need to sync full `SubnetDirectory` for classification.
- Enables constant-size verification state.
- Reduces root bottleneck for runtime auth.

## 14. Migration Strategy

1. Implement attestation issuance in Root.
2. Add verifier logic to selected services.
3. Gradually replace directory-based role validation.
4. Monitor TTL and key rotation behavior.
5. Optionally deprecate directory-based classification.

## 15. Final Decision

Canic 0.12 introduces a portable Root Role Attestation framework.

It:

- Builds on 0.11 execution consolidation.
- Preserves cryptographic domain isolation.
- Reduces directory dependency.
- Enables scalable, offline caller classification.

This is:

- A scalability and authentication architecture extension.
- Not a rewrite of delegation.
- Not a change to execution authority semantics.
